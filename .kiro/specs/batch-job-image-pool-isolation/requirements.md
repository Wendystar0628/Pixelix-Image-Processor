# 需求文档

## 介绍

本功能旨在重构图像池和批处理作业的逻辑，解决当前图像池被错误地作为作业处理的问题，确保图像池只承担文件IO和图像存储的职责，同时优化作业管理的一致性和用户体验。

## 需求

### 需求 1

**用户故事：** 作为用户，我希望图像池不会出现在作业列表中，这样我就不会误删图像池导致无法添加图片的问题

#### 验收标准

1. WHEN 用户点击"一键添加到作业"或"快速新建作业"时 THEN 系统不应在作业列表中创建名为"图像池"的作业
2. WHEN 用户查看批处理作业列表时 THEN 图像池不应出现在作业列表中
3. WHEN 图像池中有图像时 THEN 用户仍然可以正常向图像池添加新图像，无论作业列表中是否存在任何作业

### 需求 2

**用户故事：** 作为用户，我希望新建作业时系统自动选中该作业，这样我就能避免无选中状态导致的操作问题

#### 验收标准

1. WHEN 用户新建作业时 THEN 系统应自动选中新创建的作业
2. WHEN 作业列表中存在作业时 THEN 必须有一个作业处于选中状态
3. WHEN 用户删除当前选中的作业时 THEN 系统应自动选中列表中的另一个作业（如果存在）

### 需求 3

**用户故事：** 作为用户，我希望每个作业的效果相互隔离，并能清除当前作业的效果，这样我就能独立管理不同作业的处理流程

#### 验收标准

1. WHEN 用户切换作业时 THEN 每个作业应显示其独立的效果配置
2. WHEN 用户为作业应用效果时 THEN 效果应从StateManager的当前主视图已应用效果中获取
3. WHEN 用户点击"清除当前作业效果"时 THEN 当前选中作业的所有效果应被清除
4. WHEN 作业被删除时 THEN 该作业的效果配置也应被一并删除

### 需求 4

**用户故事：** 作为用户，我希望"一键添加到作业"功能只在我选中作业时才能使用，这样我就能明确知道图像会被添加到哪个作业

#### 验收标准

1. WHEN 用户点击"一键添加到作业"时 THEN 系统应将图像池中所有图像添加到当前选中的作业
2. WHEN 用户没有选中任何作业时 THEN "一键添加到作业"按钮应被禁用或显示提示信息
3. WHEN 图像池为空时 THEN "一键添加到作业"按钮应被禁用

### 需求 5

**用户故事：** 作为用户，我希望作业与其相关数据保持一致性，这样我就不会遇到作业不存在但数据残留的问题

#### 验收标准

1. WHEN 作业被删除时 THEN 该作业的"当前作业效果"信息应被一并删除
2. WHEN 作业被删除时 THEN 该作业的"作业内图片列表"信息应被一并删除
3. WHEN 系统启动时 THEN 应检查并清理任何孤立的作业数据（没有对应作业的效果或图片数据）

### 需求 6

**用户故事：** 作为开发者，我希望旧的图像池作业逻辑被彻底清除，这样就不会在未来的开发中产生混淆

#### 验收标准

1. WHEN 重构完成后 THEN 所有创建"图像池"作业的旧代码应被删除
2. WHEN 重构完成后 THEN 所有依赖图像池作业的旧逻辑应被移除
3. WHEN 重构完成后 THEN 旧的图像池管理器文件应被直接删除
4. WHEN 重构完成后 THEN 代码中不应存在任何对"image_pool"作业ID的硬编码引用