# Design Document

## Overview

简化图像池和主视窗的加载逻辑，建立清晰的单向数据流：图像池 → 主视图。消除当前的双向导入机制，确保图像池作为唯一的文件IO入口，主视图作为唯一的作业效果参考标准。

## Architecture

### 当前问题分析

1. **双向导入混乱**：图像可以从图像池自动加载到主视图，也可以从主视图双击或工具栏添加到图像池
2. **职责不清**：图像池既是存储单元又是作业对象，主视图既是显示区域又是文件入口
3. **数据流混乱**：没有明确的数据流向，导致状态管理复杂

### 目标架构

```
文件系统 → 图像池 → 主视图 → 图像处理
```

- **图像池**：唯一的文件IO入口，纯粹的存储单元
- **主视图**：唯一的作业效果参考标准，只接收来自图像池的图像

## Components and Interfaces

### 1. ImagePoolManager (修改)

**职责**：管理图像池，提供文件IO功能

**修改内容**：
- 移除自动加载到主视图的逻辑
- 保持纯粹的文件管理功能

### 2. ImagePoolPanel (修改)

**职责**：图像池UI面板

**修改内容**：
- 保留双击加载到主视图的功能
- 保留右键菜单的"加载到主视图"选项
- 移除任何自动加载逻辑

### 3. InteractiveImageLabel (修改)

**职责**：主视图图像显示组件

**修改内容**：
- 移除双击打开文件的功能
- 只保留图像显示和交互功能

### 4. ToolbarManager (修改)

**职责**：工具栏管理

**修改内容**：
- 将"添加图像"按钮的行为重定向到图像池
- 不直接打开文件对话框，而是触发图像池的添加功能

### 5. MenuManager (修改)

**职责**：菜单管理

**修改内容**：
- 将"打开文件"菜单项重定向到图像池
- 保持一致的用户体验

## Data Models

无需新增数据模型，使用现有的：
- `BatchJob`：图像池作业模型
- 现有的图像状态管理

## Error Handling

- **文件不存在**：在图像池层面处理，显示错误信息
- **格式不支持**：在文件添加时过滤，只允许支持的格式
- **主视图为空**：禁用相关的图像处理功能

## Testing Strategy

1. **单元测试**：
   - 测试图像池只能添加图像，不能自动加载
   - 测试主视图不能直接打开文件
   - 测试工具栏和菜单重定向功能

2. **集成测试**：
   - 测试完整的图像添加流程：文件 → 图像池 → 主视图
   - 测试数据流的单向性

3. **用户体验测试**：
   - 验证用户只能通过图像池添加图像
   - 验证主视图专注于作业效果展示

4. **代码清理验证**：
   - 确认所有旧的自动加载方法已被删除
   - 验证没有未使用的信号连接
   - 检查没有死代码或未使用的导入