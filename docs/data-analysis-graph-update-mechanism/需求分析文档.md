# Requirements Document

## Introduction

本文档旨在明确“数据分析图实时更新机制”的需求。当前软件在应用图像处理效果时，数据分析图的更新存在延迟和性能问题。核心目标是设计并实现一个统一的更新机制，确保只有用户当前可见的分析图进行实时计算和渲染，而隐藏的分析图则在变为可见时才更新，从而在保证界面响应速度的同时，提供及时的视觉反馈。

## Requirements

### Requirement 1: 可见图表实时更新

**User Story:** 作为用户，当我应用一项图像处理操作后，我希望当前正在查看的数据分析图能够立即刷新，以便我能立刻看到操作效果。

#### Acceptance Criteria

1.  WHEN 用户在UI中触发一个图像处理操作（如调整亮度、应用滤镜等） AND 一个数据分析图的UI面板是可见的 THEN 系统 SHALL 在操作完成后立刻重新计算并渲染该可见的图表。
2.  WHEN 图像处理操作正在进行中 THEN 系统 SHALL （可选）显示一个加载指示器，防止用户误以为程序无响应。
3.  WHEN 图像处理操作完成 THEN 系统 SHALL 确保更新后的图表准确反映了新的数据状态。

### Requirement 2: 隐藏图表延迟更新

**User Story:** 作为用户，我希望在应用图像处理操作时，那些我没有打开的（不可见的）数据分析图不要在后台进行计算，以便避免不必要的系统资源消耗，保持应用流畅。

#### Acceptance Criteria

1.  WHEN 用户触发一个图像处理操作 THEN 系统 SHALL NOT 为任何处于隐藏状态的数据分析图UI面板执行数据计算或渲染。
2.  WHEN 一个原本隐藏的图表被标记为“需要更新”后，用户切换使其变为可见 THEN 系统 SHALL 在该图表显示之前，立即触发其数据计算和渲染。
3.  WHEN 用户切换到一个数据一直为最新的隐藏图表 THEN 系统 SHALL 直接显示该图表，不进行不必要的重绘。

### Requirement 3: 统一的更新管理机制

**User Story:** 作为开发者，我希望有一个集中式的、统一的更新管理机制，以便于维护和扩展，避免在各个UI组件中编写重复的更新逻辑。

#### Acceptance Criteria

1.  WHEN 图像数据发生变化时 THEN 系统 SHALL 通过一个统一的信号或事件（如 `data_updated` 信号）通知所有相关方。
2.  WHEN 需要判断某个UI面板是否可见时 THEN 系统 SHALL 提供一个唯一的服务（如 `ViewStateManager`）来查询UI组件的可见性状态。
3.  WHEN 添加一个新的数据分析图类型时 THEN 系统 SHALL 能够通过连接到标准信号和查询可见性状态，轻松地集成到现有的更新机制中，无需修改核心逻辑。

### Requirement 4: 跨渲染引擎兼容性

**User Story:** 作为开发者，我希望新的更新机制能够同时支持 Matplotlib 和 PyQt 两种渲染模式，以便在不同模式下提供一致的用户体验和功能。

#### Acceptance Criteria

1.  WHEN 系统配置为 Matplotlib 渲染模式 THEN 系统 SHALL 应用本文档中描述的“可见时更新，不可见时延迟”的逻辑。
2.  WHEN 系统配置为 PyQt 渲染模式 THEN 系统 SHALL 同样应用本文档中描述的“可见时更新，不可见时延迟”的逻辑。
3.  WHEN 切换渲染模式时 THEN 系统 SHALL 无需修改核心更新管理逻辑（如 `AnalysisUpdateManager`），只需调整与具体渲染库相关的UI部分。
