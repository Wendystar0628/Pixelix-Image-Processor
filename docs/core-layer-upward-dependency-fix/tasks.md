# 核心层向上依赖违反分层架构修复实施任务

## 任务概述

通过建立简单的桥接适配器模式，重构依赖注入系统，彻底消除核心层对handlers层和features层的直接依赖。本次重构复用现有ConfigAccessAdapter成功实践，只新增2个文件，修改2个文件，保持最小化变更原则，确保在消除分层违反的同时保持系统稳定性和向后兼容性。

## 实施任务

### 第一阶段：创建桥接适配器接口

- [ ] **任务1: 创建上层服务桥接接口**
  - 创建app/core/interfaces/upper_layer_service_interface.py抽象接口
  - 定义具体的服务访问方法（get_app_controller等）
  - 接口简单明确，复用ConfigAccessInterface成功模式
  - _需求: 2.1, 架构清晰性_

### 第二阶段：实现桥接适配器

- [ ] **任务2: 实现上层服务适配器**
  - 创建app/core/adapters/upper_layer_service_adapter.py实现类
  - 实现服务实例存储和访问机制，复用ConfigAccessAdapter模式
  - 代码保持简单，不超过80行，无动态导入
  - _需求: 2.2, 简单性_

### 第三阶段：重构依赖注入系统

- [ ] **任务3: 重构ServiceBuilder**
  - 修改app/core/dependency_injection/service_builder.py
  - 移除所有handlers层和features层的直接导入语句
  - 通过InfrastructureBridge访问桥接适配器，无需直接创建服务
  - 保持现有API向后兼容性
  - _需求: 1.1, 3.1, 向后兼容性_

- [ ] **任务4: 重构DirectServiceInitializer**
  - 修改app/core/initialization/direct_service_initializer.py
  - 在初始化层创建上层服务实例（保留直接导入）
  - 将服务实例注册到桥接适配器，并通过InfrastructureBridge注册
  - 保持现有服务创建逻辑不变
  - _需求: 1.1, 3.2, 可维护性_

### 第四阶段：测试和验证

- [ ] **任务5: 功能验证测试**
  - 验证所有业务功能的完整性
  - 测试向后兼容性和API稳定性
  - 确保用户体验无回归
  - 验证核心层无上层导入
  - _需求: 向后兼容性, 功能完整性_

## 实施顺序

任务按顺序执行：任务1 → 任务2 → 任务3 → 任务4 → 任务5

## 质量保证检查点

### 代码审查检查点
- [ ] 是否完全移除了核心层对上层的直接导入
- [ ] 是否保持了向后兼容性和API稳定性
- [ ] 桥接适配器接口是否简单明确，复用ConfigAccessAdapter模式
- [ ] 新增代码是否保持在80行以内

### 功能验证检查点  
- [ ] 应用能正常启动，无导入错误
- [ ] 所有业务功能正常工作
- [ ] 用户体验无回归

## 成功标准

### 技术指标
- [ ] 核心层零上层导入：app/core目录下无任何向上依赖
- [ ] 应用启动成功，所有功能正常
- [ ] 只新增2个文件，修改2个文件
- [ ] 新增代码总量不超过160行

### 架构指标  
- [ ] 分层架构原则严格遵循
- [ ] 桥接适配器模式正确实现，复用现有成功实践
- [ ] 依赖注入流程保持稳定

通过这套精简的桥接适配器实施计划，可以用最小的变更消除核心层向上依赖问题，建立清晰的分层架构。